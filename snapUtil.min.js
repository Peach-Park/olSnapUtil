const pixelTolerance=10,scd=(e,t)=>{var n=e[0]-t[0],t=e[1]-t[1];return n*n+t*t};function itsc(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}const sbdst=(e,t)=>{return sd2s(pxc_,e.segment)-sd2s(pxc_,t.segment)};function sd2s(e,t){return scd(e,cos(e,t))}function cod(e,t){return Math.sqrt(scd(e,t))}function cos(e,t){var n,o=e[0],r=e[1],l=t[0],s=t[1],i=l[0],a=l[1],e=s[0],t=s[1],l=e-i,s=t-a,r=0==l&&0==s?0:(l*(o-i)+s*(r-a))/(l*l+s*s||0),s=r<=0?(n=i,a):1<=r?(n=e,t):(n=i+r*l,a+r*s);return[n,s]}let ns=[],pxc_=[];const snt=(e,t,n,o,r)=>{ns=[],pxc_=t||[],imlsg(n);var l=o.getCoordinateFromPixel([e[0]-pixelTolerance,e[1]+pixelTolerance]),n=o.getCoordinateFromPixel([e[0]+pixelTolerance,e[1]-pixelTolerance]),n=ol.extent.boundingExtent([l,n]);const s=r?r.getSource():void 0;let i=sntGetInExtent(n,s);if(!i.length)return null;i.sort(sbdst);n=i[0].segment;let a=cos(t,n),c=o.getPixelFromCoordinate(a);cod(e,c)<=pixelTolerance&&(t=o.getPixelFromCoordinate(n[0]),e=o.getPixelFromCoordinate(n[1]),t=scd(c,t),e=scd(c,e),Math.sqrt(Math.min(t,e))<=pixelTolerance&&(a=e<t?n[1]:n[0],c=o.getPixelFromCoordinate(a)));let m=new ol.Feature(new ol.geom.Point(a));return m.setStyle(new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"#57f8"}),radius:7})})),s&&s.addFeature(m),a},sntGetInExtent=(e,t)=>{e={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return sntSearch(e,t).map(function(e){return e.value})},sntSearch=(e,t)=>{let n=[];for(const r of ns){var o=r.value.segment;if(itsc(e,{minX:(o[0][0]<o[1][0]?o[0]:o[1])[0],minY:(o[0][1]<o[1][1]?o[0]:o[1])[1],maxX:(o[0][0]>o[1][0]?o[0]:o[1])[0],maxY:(o[0][1]>o[1][1]?o[0]:o[1])[1]})&&(n.push(r),t)){let e=new ol.Feature(new ol.geom.LineString(o));e.setStyle(new ol.style.Style({stroke:new ol.style.Stroke({width:5,color:"#70f8"})})),t.addFeature(e)}}return n},imlsg=e=>{for(var t=e.getGeometry().getCoordinates(),n=0,o=t.length-1;n<o;++n){var r=t.slice(n,n+2),l={feature:e,segment:r},[s,i,a,r]=ol.extent.boundingExtent(r);ns.push({minX:s,minY:i,maxX:a,maxY:r,value:l})}};